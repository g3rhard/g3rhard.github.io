---
layout: post
title:  "Настройка комфортной работы приставки MAG 250"
date:   2018-01-17 09:00:00 +0800
categories: stb
---

Не так давно в руки попало некоторое количество плат от MAG250 и в целях обучения было решено обновить закрытую прошивку на прошивку от производителя (Infomir) и доработать ее напильником.

Характеристики приставки:

```
STi7105 450Mhz, 256Mb RAM, 256Mb ROM, Linux 2.6.XX, Composite AV, HDMI 1.3, USB x 2, S/PDIF, LAN, WiFi Ready 
```

Данная приставка неплохо умеет работать с локальной сетью и файлами вплоть до разрешения FullHD, естественно, ни о каком h265 здесь речи не идет, но файлы, взятые наугад, плата прочитала спокойно.

### Замена прошивки на прошивку от Infomir

Для замены прошивки, самый простой способ, который можно использовать - перепрошить ее, используя multicast.
В BIOS плат, после их сброса, они могут выполнять поиск вещания файлов прошивки с помощью multicast, вроде того, что используется многими провайдерами, для обновления их собственного ПО.
Для этого необходимы две программы - miniDHCP сервер (закрытый от внешней сети) и программа [MCast](http://infomirpublic.s3.amazonaws.com/WIKI/mcast_v2.0.zip), ну и конечно же свежая версия прошивки. Порядок действий очень прост:

- Сброс приставки до заводского состояния (жмем на оригинальном пульте в момент подачи питания кнопку "Menu" ), находим ХХХХХХХ;
- В это время в программе Mcast выбираем два файла: загрузчик, и собственно саму прошивку;
- После перезагрузки снова заходим в BIOS и выбираем обновление ХХХХХХХХ;
- Сидим и ждем обновления прошивки;

### Обучение пульта

После того как наша приставка обновится до заводской прошивки - можно будет подключиться по ssh на стандартном порту используя учетную запись root:930920. В последней на момент написания статьи в прошивке присутствуют утилиты из [LIRC](http://www.lirc.org), в частности irrecord - утилита, которая помогает распознавать отправленные клавиши и записывать из них файл конфигурации демона lircd.

В общем случае алгоритм таков:

- Останавливаем lircd (killall lircd);
- Запускаем irrecord (irrecord myremote.conf);
- Настраиваем клавиши и записываем конфиг файл;
- Заменяем файл конфигурации и проверяем работу lircd.

### Дистанционное обновление плейлистов IPTV

К сожалению, пока не нашел способ обновлять плейлист IPTV (в формате m3u) без помощи USB накопителя. Один из возможных вариантов - монтировать шару (nfs/smb) в каталоге для монтирования флешек и, управляя через веб (предварительно включив в опциях удаленное управление), связкой bash + curl, выбрать файл с m3u плейлистом IPTV. (Подробнее о варианте [здесь](https://gist.github.com/g3rhard/2b36e66668cc5f6787a7281b749969ae))

### Добавление программ

Так как эта плата имеет ограниченные возможности по добавлению программ, в особенности по доставке медиаконтента, то в основном все приложения представляют собой адаптированные веб-ресурсы, в частности, приложение YouTube можно найти по адресу (http://youtube.infomir.com.ua) и представляет собой оно приложение, с одной стороны которое проксирует и парсит страницу YouTube, а с другой - использует API внутреннего портала приставки. Поэтому возможности написания ПО весьма ограниченна.

### Выводы

Несмотря на простоту платы, она имеет определенный потенциал, однако с развитием таких систем как Apple TV, Android TV - все больше уходит с рынка, оставаясь лишь нишевыми провайдерскими устройствами, поскольку вышеозначенные платформы имеют более удобные средства доставки контента, в отличии от подобных приставок. После некоторых тестов была убрана на полку. 

Возможных вариантов использования немного:

- Медленный NAS (USB 2.0 ограничивает скорость для доступа к файлам по сети + необходимо дополнительное питание);
- Просмотр IPTV, используя сторонние сервисы (Если CDN далеко - то на HD каналах случаются потери сигнала);
- Стрим веб-страниц, используя приложение MagicCast (Входит в комплект поставки заводской прошивки, не тестировал);
- Просмотр онлайн-кинотеатров (Прилично работают 2 кинотеатра - MEGOGO и IVI);
- Использование сторонних платных порталов разной степени кривизны.

На этом все.

### Дополнительные ссылки:

1. [MAGic Remote - TV remote control](https://itunes.apple.com/ru/app/magic-remote-tv-remote-control/id972015388?mt=8)
2. [Последняя версия прошивки от Infomir для MAG 250](http://soft.infomir.com/mag250/)
3. [Edem.TV - Онлайн телевидение](https://edem.tv)
4. [Настройка пульта для lircd](https://vovanys.com/all/nastrojka-pulta-k-orange-pi-pc-i-openelec/)
5. [Настройка lirc и пультов ду](https://sites.google.com/site/axboct/prakticeskie-sovety/nastrojka-lirc-i-pultov-du-v-mythbuntu-ubuntu)